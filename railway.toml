[build]
builder = "nixpacks"

[deploy]
startCommand = "php artisan serve --host=0.0.0.0 --port=$PORT"
healthcheckPath = "/api/health"
healthcheckTimeout = 300
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10

[env]
PHP_VERSION = "8.2"
NODE_VERSION = "18"

[[services]]
name = "app"

[services.variables]
APP_ENV = "production"
APP_DEBUG = "false"
APP_URL = "${{ RailwayPublicUrl }}"
LOG_CHANNEL = "stderr"
DB_CONNECTION = "mysql"
DB_HOST = "${{ MYSQLHOST }}"
DB_PORT = "${{ MYSQLPORT }}"
DB_DATABASE = "${{ MYSQLDATABASE }}"
DB_USERNAME = "${{ MYSQLUSER }}"
DB_PASSWORD = "${{ MYSQLPASSWORD }}"
CACHE_DRIVER = "redis"
REDIS_HOST = "${{ REDISHOST }}"
REDIS_PORT = "${{ REDISPORT }}"
REDIS_PASSWORD = "${{ REDISPASSWORD }}"
QUEUE_CONNECTION = "redis"
SESSION_DRIVER = "redis"
FILESYSTEM_DISK = "public"

[[services.ports]]
port = 8080

[[services.portMappings]]
containerPort = 8080
protocol = "http"

[[databases]]
name = "mysql"
databaseName = "stock_management"
user = "railway"
region = "us-east-1"

[[databases]]
name = "redis"
region = "us-east-1"
